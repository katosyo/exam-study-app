# デプロイ構成ルール（AWS サーバーレス / MVP）

## 基本方針

- AWS Well-Architected Framework を指針とする
- サーバーレスアーキテクチャを前提とする
- **構成の単純さ・運用コストの低さ** を最優先とする
- 高可用性・スケーリング・耐障害性はでは考慮しない

---

## フロントエンド構成

- フレームワーク: **Next.js（Static Export）**
- ホスティング: **AWS Amplify Hosting**
- 実行時にサーバーを必要としない構成とする
- SSR は使用しない
- Static Export は SPA 相当として扱う

### Amplify Hosting 採用理由

- Amplify Hosting は S3 + CloudFront の管理機能を統合したマネージドサービス
- MVP フェーズでは以下の観点から Amplify Hosting を採用する
  - Git 連携による自動ビルド・デプロイ
  - 環境変数管理の簡易化
  - SSL 証明書の自動管理
  - 運用コストの低減
- 実体は S3 + CloudFront であるため、アーキテクチャ方針に逸脱しない

---

## バックエンド構成

- 実装: **AWS Lambda**
- 公開方法: **Amazon API Gateway**
- すべての API は **Stateless** とする
- セッション管理は禁止
- フロントエンドからの直接的な AWS リソースアクセスは禁止

---

## データベース構成

- データストア: **Amazon DynamoDB**
- MVP では以下のデータのみを保持する
  - 問題データ
- 回答履歴・ユーザー関連データは保存しない
- 単一テーブル設計を基本とする

---

## 認証・認可

- MVP フェーズでは **認証・認可は実装しない**
- 将来的な認証追加（Cognito 等）を妨げる設計は禁止する

---

## インフラ管理

### バックエンド

- インフラ定義は **AWS SAM** を使用する
- `template.yaml` ですべてのリソース（Lambda, API Gateway, DynamoDB）を定義する
- 手動でのバックエンドリソース作成は禁止

### フロントエンド

- **AWS Amplify Hosting** で管理する
- 初回セットアップは AWS コンソールまたは Amplify CLI で実行
- ビルド設定は `amplify.yml` で管理する
- Git 連携による自動デプロイを基本とする

### 共通原則

- 手動でのリソース作成・変更は最小限にする
- 設定変更は再現可能な形で記録する

---

## 将来拡張を見据えた前提（実装はしない）

以下は **正式リリース以降の拡張対象**とし、  
MVP では実装しないが、設計上の考慮は行う。

- Cognito 等による認証・認可の追加
- 回答履歴保存用 DynamoDB テーブルの追加
- 学習分析・集計用 Lambda の追加
- 分析処理の高度化に伴う Step Functions の導入

---

## 逸脱禁止

本ルールに反する構成・サービス選定・実装方針を提案してはならない。  
変更が必要な場合は、理由と代替案を明示すること。
